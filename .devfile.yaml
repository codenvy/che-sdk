#
# Copyright (c) 2022-2023 Red Hat, Inc.
# This program and the accompanying materials are made
# available under the terms of the Eclipse Public License 2.0
# which is available at https://www.eclipse.org/legal/epl-2.0/
#
# SPDX-License-Identifier: EPL-2.0
#
schemaVersion: 2.1.0
metadata:
  name: che
  language: typescript
attributes:
  controller.devfile.io/scc: container-build
  controller.devfile.io/storage-type: per-workspace
projects:
  - name: che
    git:
      remotes:
        origin: 'https://github.com/ScrewTSW/che.git'
        upstream: 'https://github.com/eclipse/che.git'
      checkoutFrom:
        remote: origin
        revision: devtools-week-che-dogfooding-test-development
components:
- name: devtools
  container:
    image: quay.io/devfile/universal-developer-image:ubi8-latest
    memoryLimit: 4G
    memoryRequest: 256Mi
    cpuLimit: 500m
    cpuRequest: 30m
    mountSources: true
    sourceMapping: /projects
commands:
- id: update-contributing
  exec:
    commandLine: '.repositories-update-contributing.sh IN_DOCKER'
    component: devtools
- id: check-contributing-is-updated
  exec:
    commandLine: '.repositories-update-contributing.sh IN_DOCKER'
    component: devtools
- id: tests-update-dependencies
  exec:
    commandLine: >-
      cd tests/e2e &&
      echo "Updating npm" &&
      npm install -g npm &&
      echo "Updating nodejs" &&
      nvm install Gallium &&
      echo "Installing typescript" &&
      npm install -g typescript &&
      echo "Installing test dependencies" &&
      rm -rf package-lock.json &&
      npm install &&
      npm uninstall chromedriver && npm install chromedriver --save-dev &&
      cd ../../
    component: devtools
